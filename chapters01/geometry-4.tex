%    \begin{macro}
%    This macro is a helper macro to set the paper height and width
%    we also save the paper name in its own macro.
%    \begin{macrocode}
\gdef\setpapersize@cx#1#2#3{%
   \gdef\papername{#1}
   \setlength\paperheight{#2}
   \setlength\paperwidth{#3}
   % headheight is common to all so we set it here
   \setlength\headheight{12\p@}
  % if pdf we need to set the pageheight and pagewidth
  \global\pdfpageheight=#2
  \global\pdfpagewidth=#3
}
%    \end{macrocode}
%    \end{macro}
%
%    \begin{macro}
%    \begin{macrocode}
\def\setparams@cx#1#2#3{%
    \def\X{#3}\def\XX{11pt}
    % 11pt font set it as well
    \ifx\X\XX
          \@setfontsize\normalsize\@xipt{13.2}\selectfont%
          \abovedisplayskip 13.2\p@ \@plus 3\p@ \@minus 3\p@
          \abovedisplayshortskip \z@ \@plus 3\p@
           \belowdisplayshortskip 6.6\p@ \@plus 3\p@ \@minus 3\p@
    \else
       \def\XX{12pt}
        \ifx\X\XX
           \@setfontsize\normalsize\@xiipt\@xivpt\selectfont
           \abovedisplayskip 14.4\p@ \@plus 3\p@ \@minus 3\p@
           \abovedisplayshortskip \z@ \@plus 3\p@
          \belowdisplayshortskip 7.2\p@ \@plus 3\p@ \@minus 3\p@
       \fi
    \fi
    \setlength\headsep{#3}
    \setlength\footskip{#2}
    \setlength\topskip{#3}
    \setlength\maxdepth{0.5\topskip} % need to check
 }
%    \end{macrocode}
%    \end{macro}
%
%    We now set keys for all the paper sizes  
\cxset{
        a4paper/.code=\setpapersize@cx{a4paper}{297mm}{210mm},
        a5paper/.code=\setpapersize@cx{a5paper}{210mm}{148mm},
        a6paper/.code=\setpapersize@cx{a6paper}{105mm}{148},
        b5paper/.code=\setpapersize@cx{b5paper}{250mm}{176mm},
        letterpaper/.code=\setpapersize@cx{letterpaper}{11n}{8.5in},
        legalpaper/.code=\setpapersize@cx{legalpaper}{14in}{8.5in},
        executivepaper/.code=\setpapersize@cx{executivepaper}{10.5in}{7.25in},
}
%    the classical dimesions were obtained from the Octavo class
%    we use mm or in depending on the type of paper standard
\cxset{foolscap/.code=\setpapersize@cx{foolscap}{171mm}{108mm},
          crown/.code=\setpapersize@cx{crown}{191mm}{127mm},
          post/.code=\setpapersize@cx{post}{194mm}{122mm},
          large post/.code=\setpapersize@cx{large post}{210mm}{137mm},
          demy/.code=\setpapersize@cx{demy}{222mm}{143mm},
          medium/.code=\setpapersize@cx{medium}{229mm}{146mm},
          royal/.code =  \setpapersize@cx{royal}{254mm}{159mm},
          superroyal/.code=\setpapersize@cx{superroyal}{267mm}{171mm}, 
          imperial/.code=  \setpapersize@cx{imperial}{279mm}{191mm}}
%   Lulu paper sizes
%   http://wepod.wordpress.com/lulu-specs/
%Manuscript Templates
%6″ x 9″  US TRADE
%(15.24cm x 22.86cm)
%8.5″ x 11″
%(21.59cm x 27.94cm)
%Comic, 6.625″ x 10.25″
%(16.827cm x 26.03cm)
%Landscape, 9″ x 7″
%(22.86cm x 17.78cm)
%Square, 7.5″ x 7.5″
%(19.05cm x 19.05cm)
%Pocket Size, 4.25″ x 6.875″
%(10.8cm x 17.46cm)
%Royal, 15.6cm x 23.4cm
%(6.14″ x 9.21″)
%Crown Quarto, 18.9cm x 24.6cm
%(7.44″ x 9.68″)
%A4, 21.0cm x 29.7cm
%(8.27″ x 11.69″)
%   Set the parameters that depend on font-sizes
\cxset{
        lulu pocketbook/.code=\setpapersize@cx{lulu pocket book}{6.87in}{4.25in},
	lulu digest/.code=\setpapersize@cx{lulu digest}{8.5in}{5.5in},
	lulu us trade/.code=\setpapersize@cx{lulu us trade}{9in}{6in},
	lulu royal/.code=\setpapersize@cx{lulu royal}{9.21in}{6.13in},
	lulu comic/.code=\setpapersize@cx{lulu comic}{10.25in}{6.625in},
	lulu crown quarto/.code=\setpapersize@cx{lulu crown}{9.68in}{7.44in},
	lulu small square/.code=\setpapersize@cx{lulu small}{7.5in}{7.5in},
	lulu square/.code=\setpapersize@cx{lulu large}{8.5in}{8.5in},
	lulu landscape/.code=\setpapersize@cx{lulu landscape}{7in}{9in},
	%lulu large landscape/.code=\setpapersize@cx{lulu large landscape}{}{},
}

\cxset{
         10pt/.code=\setparams@cx{6pt}{25pt}{10pt},
         11pt/.code=\setparams@cx{7pt}{27.5pt}{11pt},
         12pt/.code=\setparams@cx{8pt}{30pt}{12pt} \@setfontsize\normalsize\@xiipt\@xivpt\selectfont,
}%

%   we need to set a default size before we determine the
%   rest of the parameters.
% \cxset{a4paper,10pt}

% does not seem to work
%\@setfontsize\normalsize\@xiipt\@xivpt\normalsize

%    set a default top margin first
\def\topmarginauto{%
\setlength{\topmargin}{0.1\paperheight}
    \addtolength{\topmargin}{-\headheight}
    \addtolength{\topmargin}{-\headsep}
    \addtolength{\topmargin}{-1in}
}

\cxset{topmargin/.code=\setlength{\topmargin}{#1}}
\cxset{topmargin latex/.code=\topmarginauto}
\cxset{topmargin latex}

%   \section{Calculation of textwidth}
%    The calculation of textwidth will depend on the strategy employed to calculate it.
% \begin{macro}{\textwidth}
%    Define the width of the text block to 0.7 of the page width, and make
%    calculations a little easier by adjusting the calculated width to a 
%    whole number of points.
%    \begin{macrocode}
\iffalse
\setlength{\textwidth}{0.7\paperwidth}
    \@settopoint\textwidth
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\textheight}
%    The height of the text block itself is set to 0.7 times the page height. 
%    This amount is then adjusted to ensure that a whole number of lines makes 
%    up the text block, and does so exactly.
%    \begin{macrocode}
\setlength\@tempdima{0.7\paperheight}
%    \end{macrocode}
%    take away the first line, which is a bit shorter than the |\baselineskip|,
%    \begin{macrocode}
    \addtolength\@tempdima{-\topskip}
%    \end{macrocode}
%    this length may be very close, but just a little too small to accommodate 
%    one more line, so we add a small amount,
%    \begin{macrocode}
    \addtolength\@tempdima{5\p@}
%    \end{macrocode}
%    and calculate the number of lines in this length,
%    \begin{macrocode}
    \divide\@tempdima\baselineskip
    \@tempcnta=\@tempdima
%    \end{macrocode}
%    The correct textheight comes to the number of lines just calculated, 
%    multiplied by the height of text lines, |\baselineskip|, and with the 
%    addition of the |\topskip| we took away initially.
%    \begin{macrocode}
    \setlength\textheight{\@tempcnta\baselineskip}
    \addtolength\textheight{\topskip}
%    \end{macrocode}
% \end{macro}
%
% \subsubsection{Margin dimensions}
%     Now that we have set the size of the text block, the amount of space
%     available for margins is set as well. The remaining white space is divided
%     in a 1:2 ratio, hence the proportions between margins and text become 1:7:2.
%
% \begin{macro}{\evensidemargin}
% \begin{macro}{\oddsidemargin}
%    Since we are typesetting books, both even and odd side margins have to be
%    set.
%    \begin{macrocode}
\setlength{\evensidemargin}{0.2\paperwidth}
\addtolength{\evensidemargin}{-1in}
\setlength{\oddsidemargin}{0.1\paperwidth}
\addtolength{\oddsidemargin}{-1in}
%    \end{macrocode}

\fi
%% end of octavo algorithm and calculations

%    Define an innermargin to enable easy drawing of parameters
\newlength\innermargin
\newlength\lefttrim
\newlength\bottomtrim

%    The stockheight and stockwidth are used when the paper is to be trimmed
%    they default to the dimensions for paper width and paper height
\@ifundefined{stockheight}{\global\newlength\stockheight}{}
\@ifundefined{stockwidth}{\global\newlength\stockwidth}{}
\ifdim\stockheight=0pt\addtolength\stockheight{\paperheight}\fi
   \addtolength\stockheight{0mm}
%
\ifdim\stockwidth=0pt\addtolength\stockwidth{\paperwidth}\fi
   \addtolength\stockwidth{0mm}
%
%   We set all the trims to zero to start with.
\setlength\lefttrim{0mm}
\setlength\bottomtrim{0mm}
\setlength\trimtop{0mm}
\setlength\trimedge{0mm}
%
%   


%% This is a sidenote without the footnote mark
%\newcommand\marginnote[2][0pt]{%
% % \let\cite\@tufte@infootnote@cite%   use the in-sidenote \cite command
%  %\gdef\@tufte@citations{}%           clear out any old citations
%  \@tufte@margin@par%                 use parindent and parskip settings for marginal text
%  \marginpar{\hbox{}\vspace*{#1}\marginparfont@cx\marginparjustification@cx\vspace*{-1\baselineskip}\noindent #2}%
%  \@tufte@reset@par%                  use parindent and parskip settings for body text
%  %\@tufte@print@citations%            print any citations
%  %\let\cite\@tufte@normal@cite%       go back to using normal in-text \cite command
%}

% This macro has been adapted from the layouts package, it sets the units to be printed
% in the diagrams.
\newcommand{\printinunitsof@cx}[1]{%
  \def\l@yunitperpt{1.0}\def\l@yunits{pt}%
  \def\l@yta{#1}\def\l@ytb{pt}%
  \ifx \l@yta\l@ytb
    \def\l@yunitperpt{1.0}\def\l@yunits{pt}%
  \else
    \def\l@ytb{pc}%
    \ifx \l@yta\l@ytb
      \def\l@yunitperpt{0.083333}\def\l@yunits{pc}%
    \else
      \def\l@ytb{in}%
      \ifx \l@yta\l@ytb
        \def\l@yunitperpt{0.013837}\def\l@yunits{in}%
      \else
        \def\l@ytb{mm}%
        \ifx \l@yta\l@ytb
          \def\l@yunitperpt{0.351459}\def\l@yunits{mm}%
        \else
          \def\l@ytb{cm}%
          \ifx \l@yta\l@ytb
            \def\l@yunitperpt{0.0351459}\def\l@yunits{cm}%
          \else
            \def\l@ytb{bp}%
            \ifx \l@yta\l@ytb
              \def\l@yunitperpt{0.996264}\def\l@yunits{bp}%
            \else
              \def\l@ytb{dd}%
              \ifx \l@yta\l@ytb
                \def\l@yunitperpt{0.9345718}\def\l@yunits{dd}%
              \else
                \def\l@ytb{cc}%
                \ifx \l@yta\l@ytb
                  \def\l@yunitperpt{0.0778809}\def\l@yunits{cc}%
%                \else
%                  \def\l@ytb{PT}%
%                  \ifx \l@yta\l@ytb
%                    \def\l@yunitperpt{1.0}\def\l@yunits{PT}% gives problems with pgfmathparse
%                  \fi
                \fi
              \fi
            \fi
          \fi
        \fi
      \fi
    \fi
  \fi
}

% Define keys to set it
\cxset{geometry units/.code=\printinunitsof@cx{#1}}
\cxset{geometry units=pt}

% #1 value in pts
% default in mm sorry USA.
% rounding in 1 decimal place
\def\convert@cx#1{%
   \pgfmathparse{#1*\l@yunitperpt}
   %\pgfmathround{\pgfmathresult}
   \pgfmathresult\thinspace\l@yunits
}

% Layout related macros to go to separate style file
\def\aspectratio{\pgfmathparse{\paperheight/\paperwidth} \pgfmathresult}



\def\alignedge{%
% removed parindent from here must add it at the image
  \checkoddpage%
%   \ifoddpage \global\setlength\innermargin{\oddsidemargin}
%          \else \global\setlength\innermargin{\evensidemargin}
%      \fi%
%   \if@twoside\setlength\innermargin{\dimexpr(\evensidemargin-\marginparsep)}%
%             \else\let\innermargin\oddsidemargin\fi
   \ifoddpage 
      \innermargin\oddsidemargin
      \def\innermarginname{oddsidemargin}%
     \else
        \innermargin\evensidemargin
        \def\innermarginname{evensidename}%
  \fi
  }

\alignedge


% Set to true to draw an oddside page. Initially set to false.
\newcommand\layoutscale@cx{0.4}

\newif\ifoddpagelayout@cx
   \oddpagelayout@cxtrue

% Set true to draw marginpars on a page
\newif\ifdrawmarginpars
   \drawmarginparstrue

% This draws a two page spread
\newlength\bindingcorrection
\newlength\oneninth
\newlength\sixninths
\setlength\oneninth{\dimexpr(\paperwidth/9)}
\setlength\sixninths{\dimexpr(\paperwidth*6/9)}
\let\trytextwidth\sixninths


\newcommand{\alphabet}{\normalfont\selectfont\raggedleft abcdefghijklmnopqrstuvwxyz}%82



\newcommand\charactersperline{%
  \settowidth{\@tempdima}{\alphabet}
  \pgfmathparse{\textwidth/\@tempdima*26}
 \pgfmathprintnumber{\pgfmathresult}
}

\newcommand\alphabetsperline{
  \settowidth{\@tempdima}{\alphabet}
  \pgfmathparse{\textwidth/\@tempdima}
  \pgfmathresult
}

\newlength\alphlength
\newcommand\alphabetlength{%
  \settowidth{\alphlength}{\alphabet}
  \pgfmathparse{\alphlength}
  \pgfmathprintnumber{\pgfmathresult}pt
}

% We need to use the fp package to calculate the ratios, as PGF has problems with large 
% dimensions or I am making an error
\newcommand\textarearatio{%
    \FPmul{\result}{\strip@pt\textwidth}{\strip@pt\textheight}
    \FPmul{\resulti}{\strip@pt\paperwidth}{\strip@pt\paperheight}
    \FPdiv{\resultii}{\result}{\resulti}
    \pgfmathprintnumber{\resultii}
}

% Calculate the ratio textheight/paperheight
\newcommand\textheightratio{%
    \FPdiv{\result}{\strip@pt\textheight}{\strip@pt\paperheight}
    \FPround{\result}{\result}{2}
    \result
}

% Calculate textheight/paperwidth

\newcommand\textheighttopaperwidth{%
    \pgfmathparse{\textheight/\paperwidth}
    \pgfkeys{/pgf/number format/.cd,fixed,precision=2}
    \pgfmathprintnumber{\pgfmathresult}
}

\newlength\margintop

\newcommand\thetop{%
   \pgfmathparse{1in+\topmargin+\headheight+\headsep}
   \pgfmathsetlength{\margintop}{\pgfmathresult}
}

\thetop

\newlength\marginbottom
\newcommand\thebottom{%
   \pgfmathparse{\stockheight-(1in+\topmargin+\headheight+\headsep+\textheight)}
    \pgfmathsetlength{\marginbottom}{\pgfmathresult}
  }
\thebottom

\newcommand\verticalmarginratio{%
\pgfmathparse{(\paperheight-(1in+\topmargin+\headheight+\headsep+\textheight))/  (\paperheight-(1in+\topmargin+\headheight+\headsep+\textheight))}
\pgfmathresult
}

\newcommand\horizontalmarginratio{%
\pgfmathparse{(\paperwidth-\textwidth-\oddsidemargin)/(1in+\oddsidemargin)}
\pgfmathresult
}

\newcommand\numbertextlines{%
% baselineskip to be corrected
   \pgfmathparse{(\textheight-\topskip)/(12)-1}\pgfmathresult
}

\cxset{geometry units=mm}

\def\printgeometryvalues{%
   \noindent
   \begin{tabular}{ll}
   papername & \papername\\
   paperwidth & \convert@cx{\paperwidth}\\
   paperheight & \convert@cx{\paperheight}\\
   voffset & \convert@cx{\voffset}\\
   hoffset & \convert@cx{\hoffset}\\
   thetextheight & \convert@cx{\textheight}\\
   thetextwidth  & \convert@cx{\textwidth}\\
   Top margin   &  \thetop\convert@cx{\the\margintop}\\  % need to correct
   Bottom margin & \thebottom\\
   thetopmargin & \convert@cx{\topmargin}\\
   theheadheight & \convert@cx{\headheight}\\
   theheadsep & \convert@cx{\headsep}\\
   theoddsidemargin & \convert@cx{\oddsidemargin}\\
   theevensidemargin & \convert@cx{\evensidemargin}\\
   themarginparsep& \convert@cx{\marginparsep}\\
   themarginparwidth& \convert@cx{\marginparwidth}\\
   themarginpush& \convert@cx{\marginparpush}\\
   thevoffset& \convert@cx{\voffset}\\
   thefootskip& \convert@cx{\footskip}\\
   aspect ratio \aspectratio\\
   twoside&  \if@twoside true\else false\fi\\
   reversemarginpar& \if@mparswitch true \else false\fi\\
  \end{tabular}
 }

\def\readability{%
\begin{tabular}{lr}
  Characters per line &\charactersperline\\
  Alphabets per line &\alphabetsperline\\
  Alphabet length &\alphabetlength\\
  Baselineskip & \the\baselineskip\\
  Number of text lines &\numbertextlines\\
  Text area ratio &\textarearatio\\
  textheight/paperwidth&\textheighttopaperwidth\\
  Text/page height ratio & \textheightratio\\
  Vertical margin ratio &\verticalmarginratio\\
  Horizontal margin ratio &1:\horizontalmarginratio\\
\end{tabular}}


% Note with new geometry paper has to be defined in preamble
% I do not feel very confident of this
% Don't understand it fully how is working
 %\@twosidefalse \@mparswitchfalse % one side option
%\cxset{geometry oxford/.code={
%\newgeometry{left=74.8mm,top=27.4mm,headsep=2\baselineskip,%
%marginparsep=8.2mm,marginparwidth=49.4mm,textheight=49\baselineskip,headheight=\baselineskip}
%\@twosidefalse \@mparswitchfalse % one side option
%\reversemarginpar
%}}
% \@mparswitchfalse
%\cxset{geometry textwidth/.store in=\textwidth@cx,
%          geometry textheight/.store in=\textheight@cx,
%          geometry tufte/.code={
%             \newgeometry{a4paper,left=24.8mm,top=27.4mm,headsep=2\baselineskip,%
%             textwidth=107mm,marginparsep=8.2mm,marginparwidth=49.4mm,%
%             textheight=\textheight@cx\baselineskip,headheight=\baselineskip}
%            \@twosidefalse \@mparswitchfalse % one side option
%           %\reversemarginpar
%    }
%}
%
%
%\cxset{marginpar push/.store in=\marginparpush@cx,
%          marginpar font/.store in=\marginparfont@cx,
%          marginpar justification/.is choice,
%          marginpar justification/justifying/.code=\gdef\marginparjustification@cx{\justifying},
%          marginpar justification/raggedright/.code=\gdef\marginparjustification@cx{\raggedright},
%          marginpar justification/RaggedRight/.code=\gdef\marginparjustification@cx{\RaggedRight},
%          marginpar justification/RaggedLeft/.code=\gdef\marginparjustification@cx{\RaggedLeft},
% }
%%\cxset{marginpar push=10pt,
%%          marginpar font=\normalfont\footnotesize\sffamily,
%%          marginpar justification=RaggedLeft}
%%
%%
%%\cxset{style13, geometry textheight=47,
%%          %geometry tufte,
%%          watermark text=SAMPLE TUFTE VARIANT,
%%          watermark text color=thered,
%%          header style=samplepage}
%%%%%%%%%%%%%%%%%%%%
\chapter{Geometry and Page Dimensions}
\parindent1.5em

\section{Introduction}

Setting up the page geometry, is normally done by the class or if adjustments need to be made, most authors will use the package geometry. If you need to view the geometry and the values of the document layout you can use the pkg{layouts}. This package offers a set of convenience key values for setting up geometry in order to enable authors to have a comprehensive style sheet.

\section{How to set geometry via this package}

To set the geometry page of the whole document, set the keys in the preamble. To change the page geometry anywhere in the document use the appropriate style or keys where you want the page geometry to change.
Note that the paper zize can only be defined in the preamble. The package is more useful when loaded with predefined styles.

\begin{tcolorbox}
\begin{lstlisting}
\cxset{page geometry=medieval}
\end{lstlisting}
\end{tcolorbox}

In most instances you will want to load the geometry at the style sheet.


\section{Viewing the page geometry}

The package offers a number of keys to set documents either document wide or locally to change page 
parameters or to view the frames. this is very similar to what the layouts and geometry packages offer. We do
however use TikZ for these diagrams.

To incorporate a layouts diagram we offer two macros \cs{printlayout} and \cs{printlayoutvalues}. Both have associated styling keys.
\medskip

\section{Technical discussion}
\subsection{The LaTeX standard classes}

LaTeX has pre-build layouts that are based on two variables. The \textit{paper size} and the \textit{font size}. Appropriate values are calculated in the class.

\subsection{Other common classes}

The more generic classes such as memoir and koma-script offer extensive customization and calculation of page parameters. They all use the basic laTeX page terminology which they supplement for additional parameters.

The octavo class offers a set of paper sizes suited for classical layouts printed on classical sizes such as the octavo. Classes such as the tufte-book offer a fixed design and no special commands for parameter manipulation.

\subsection{Paper sizes}
Most people using LaTeX, will print on either a4paper or letterpaper sizes. If you going to bind the work it might be necessary to trip the paper a little bit during binding to make sure that the top and side of the book are not ragged. This is normally called the \textit{trim}. If the document is to be printed by a publishing house this might be done by the printer which will use a different size \textit{stock size}. They might also allow for two additional dimensions called the spinemargin or the foremargin.

\subsection{The page dimensions}

The page dimensions are shown in figure 1. We tried to cater for the common terminology of all the classes.

\subsection{Texwidth}

The width of the text can only be determined based on the designer's strategy and is inexorably tied also to
the textheight. For example in classical page design, the designer tried to get the textwidth to be the same size like the page width, thus giving an almost squarish look. Another strategy is the 6-9 strategy, where the paper is divided into a grid of 9 equal blocks and the textwidth occupies the 6. 

\subsection{Readability considerations}

An average line that is longer than 40 to 70 characters long -- inluding spaces, is difficult to read. This is generally applicable to European languages and might be different for other languages. In addition the average number of words in one line should also be considered. For the German language Willi Egger (2004) recommends a line consisting of 8 to 12 words as optimal. If this strategy is adopted one can determine the line length based on the number of letters.

The characters per line for this document is \charactersperline. Of course from a readabilty point of view one could keep increasing the font size, but this is poor strategy. A well designed page should allow for good proportions as well as readabilty. In general a tolerance up  to 80 characters on a line should be adequate.

Peter Wilson in the manual for the memoir class refers to equations developed by Morten H{\o}gholm\index{H{\o}gholm, Morten} that has done some curve fitting
to the data. He determined that the expressions
\begin{equation}
L_{65} = 2.042\alpha + 33.41 \label{eq:L65}
\end{equation}
and
\begin{equation}
L_{45} = 1.415\alpha + 23.03 \label{eq:L45}
\end{equation}
fitted aspects of the data, where $\alpha$ is the length of the alphabet
in points, and $L_{i}$ is the suggested width in points, for a line with
$i$ characters (remember that 1pc = 12pt).

Using these equations one could get a first estimate of the textwidth. I am not too sure though if this is a good strategy as one can calculate it fully using TeX. bringhurst and them had to read these values from tables, but we do not; we can easily calculate them. For example to calculate the alphabet length for the bookman font:

\begin{texexample}{}{}
  \bgroup
  \fontfamily{pbk}\selectfont\alphabetlength\\
  \charactersperline\\
  \the\textwidth
  \egroup
\end{texexample}

Table~\ref{tab:alphlengths} adapted from the memoir class, gives alphabet lengths in points for various
fonts. My own recommendation is that for wide paper you should use a wider font and possibly move to 11pt font, rather than the traditional LaTeX default of 10pt.

\begin{table}
\centering
\caption{Lowercase alphabet lengths, in points, for various fonts}\label{tab:alphlengths}
\begin{tabular}{lrrrrrrrr} \toprule
                                            & 8pt & 9pt & 10pt & 11pt & 12pt & 14pt & 17pt & 20pt \\ \midrule
\fontfamily{pbk}\selectfont Bookman         & 113 & 127 & 142 & 155 & 170 & 204 & 245 & 294 \\
\fontfamily{bch}\selectfont Charter         & 102 & 115 & 127 & 139 & 152 & 184 & 221 & 264 \\
\fontfamily{cmr}\selectfont Computer Modern & 108 & 118 & 127 & 139 & 149 & 180 & 202 & 242 \\
\fontfamily{ccr}\selectfont Concrete Roman  & 109 & 119 & 128 & 140 & 154 & 185 & 222 & 266 \\
\fontfamily{pnc}\selectfont New Century Schoolbook     & 108 & 122 & 136 & 149 & 162 & 194 & 234 & 281 \\ 	
\fontfamily{ppl}\selectfont Palatino        & 107 & 120 & 133 & 146 & 160 & 192 & 230 & 276 \\ 	
\fontfamily{ptm}\selectfont Times Roman     &  96 & 108 & 120 & 131 & 143 & 172 & 206 & 247 \\
\fontfamily{put}\selectfont Utopia          & 107 & 120 & 134 & 146 & 161 & 193 & 232 & 277 \\
\fontfamily{pag}\selectfont Avant Garde Gothic  & 113 & 127 & 142 & 155 & 169 & 203 & 243 & 293 \\
\fontfamily{cmss}\selectfont Computer Sans  & 102 & 110 & 120 & 131 & 140 & 168 & 193 & 233 \\
\fontfamily{phv}\selectfont Helvetica       & 102 & 114 & 127 & 139 & 152 & 184 & 220 & 264 \\
\fontfamily{pcr}\selectfont Courier         & 125 & 140 & 156 & 170 & 187 & 224 & 270 & 324 \\
\fontfamily{cmtt}\selectfont Typewriter     & 110 & 122 & 137 & 149 & 161 & 192 & 232 & 277 \\
\bottomrule
%\facesubseeidx{Bookman}\facesubseeidx{Charter}\facesubseeidx{Computer Modern}%
%\facesubseeidx{Concrete Roman}\facesubseeidx{New Century Schoolbook}
%\facesubseeidx{Palatino}\facesubseeidx{Times Roman}\facesubseeidx{Utopia}%
%\facesubseeidx{Avant Garde Gothic}\facesubseeidx{Computer Sans}
%\facesubseeidx{Helvetica}\facesubseeidx{Courier}%
%\facesubseeidx{Computer Typewriter}%
\end{tabular}
\end{table}

\subsection{Textwidth influenced by margin materials}

Many books, including LaTeX allow for margin materials. If this is true then of course margins must by their nature be larger at the paper edges to allow for such material. 

\subsubsection{Simple strategy}
However, despite most of the above typesetting strategies many an author just want to take an approach, where they specify the margins and want to get what they need for example a spine margin of 1cm and an edge margin of 1.5cm. This is also important for screen dimensions.

\begin{lstlisting}
\cxset{
    margin inner= 1in
    margin outer= 2in
    margin top=1in
    margin bottom=2in
}
\end{lstlisting}

If all four margins are specified, the typesetting area can be positioned on the paper block. Life is not this easy though.

\begin{lstlisting}
\cxset{
    textarea proportional={1}{6}{2}  %
    textarea octavo
    textarea latex
    textarea other
}
\end{lstlisting}

\subsection{Auto strategy}

A more involved approach is to combine the strategies. First to get a good margin to type area, you will need to choose a paper that has good ratios. A paper such as \textit{imperial} comes close to an A4 size or imperial size. One can trip the balance of the paper or adjust slightly the ratios for twoside printing. Since we talking about book design any consideration for one side printing is immaterial. For oneside printing one can accept a wider latitude of values. Algorithm follows:

\begin{enumerate}
\item select paper.
\item select font.
\item marginmaterial true or false.
\item financial constraints - minimize number of pages, maximize number of pages.
\item check ideal number of characters at 65 per line.
\item decide on 10pt, 11pt or 12pt and constrain the algorithm.
\item use 0.7 textwidth area and check for max characters, if not iterate to 11pt.
\item recommend trimming values to suit.
\end{enumerate}


\subsection{Textheight}
Normally there is more latitude in choosing the 
proportions\index{proportion!margin} 
of the upper and lower margins, though usually the upper 
margin\index{margin!upper} is less than the lower margin\index{margin!lower}
so the typeblock\index{typeblock!location} is not vertically centered. Many modern books disregard all these rules and in many examples the upper margin is higher than the lower margin.

For text height calculations there are two considerations. One is to select top and bottom margings that are either equal or at a 1:1.5--2.0 ratio and relate to the width of the horizontal margins. The second consideration is that this length must be exactly divisible by baselineskip. When using \cs{flushbottom} LaTeX expects that the \cs{textheight} is such that a number of textlines in the body font will fit exactly into the height. If not, it issues an underfull vbox's message. LaTeX calculates these parameters when loading the class .clo files and sets the number of lines to a round number.

Many modern books have equal upper and lower margins.

\section{Allowing for trims}
\newpage


\cxset{geometry units=pt}
% lots of keys for trial sizes. We default all sizes to the ones defined in
% by the document class.

% We first set keys for the vertical dimensions
\newlength\trytextheight@cx
\newlength\tryheadheight@cx
\newlength\tryheadsep@cx
\newlength\tryfootskip@cx
% LaTeX uses a correction to adjust the top margin, which is called topmargin. It does not 
% represent the top margin though which following geometry we denote as top. It could perhaps
% better be called top margin correction

\newlength\trytopmargin@cx

% Set keys for all the vertical dimensions and default to the current document settings
\cxset{try textheight/.code=\global\setlength\trytextheight@cx{#1},
          try textheight/.default=\textheight,
          try headheight/.code=\global\setlength\tryheadheight@cx{#1},
          try headheight/.default=\headheight,
          try headsep/.code=\global\setlength\tryheadsep@cx{#1},
          try headsep/.default=\headsep,
          try footskip/.code=\global\setlength\tryfootskip@cx{#1},
          try footskip/.default=\footskip,
          try topmargin/.code=\global\setlength\trytopmargin@cx{#1},
          try topmargin/.default=\topmargin,
}

% Set keys for all the trims, different people have different names for them. Normally two trims are
% specified the top trim and the edge trip. We define two others just in case and to make calculations
% easier if we have to use a different stock paper from the actual virtual paper width. the virtual
% paper is called the paperwidth and paperheight.

% We need to pick-up the memoir and koma allowances.
\cxset{try trimtop/.code=\global\setlength\trytrimtop@cx,
          try trimtop/.default=0pt}

% set all the defaults

\cxset{try textheight,
          try headheight,
          try headsep,
          try footskip,
          try topmargin}


\reversemarginparfalse

\def\drawlayout{%
\checkoddpage
\alignedge

\tikzset{dim/.style = {>= latex,color=black}}
\begin{tikzpicture}[scale=0.45,font={\scriptsize\rmfamily},line width=.8pt,
       every node={color=black}]
% draw stockwidth and stockheight
\draw [color=gray] (0,0) rectangle ++(\stockwidth,\stockheight);


% draw the paper 
\draw [color=NavyBlue,dashed]  (0+\lefttrim,\stockheight-\trimtop) rectangle ++ (\stockwidth-\lefttrim-\trimedge,-\stockheight+\trimtop+\bottomtrim);
% dimensions one more try
%\cxset{geometry units=mm}
% paper width dimensions, better to change to a macro
% tol is the distance to dimension

% paper width
\edef\tol{-2.5\baselineskip}
\coordinate (A) at (0+\lefttrim,\tol);
\coordinate (B) at (\stockwidth-\trimedge,\tol);
\coordinate (C) at (0.5\stockwidth,\tol);
\draw[dim, |<->|] (A) -- (B); 
\node at (C) [yshift=0.5\baselineskip)]{paper width = \convert@cx{\paperwidth}};

% stockwidth
\edef\tol{-5\baselineskip}
\coordinate (BD) at (0,\tol);
\coordinate (BD2) at (\stockwidth,-5\baselineskip);
\draw[dim, |<->|] (BD) -- (BD2); 
\node at (BD)[yshift=0.5\baselineskip,xshift=0.25*\stockwidth]{stockwidth=\convert@cx{\stockwidth}} ;

% top dimension at left
\coordinate (H1) at (-5mm,\stockheight);
\coordinate (H2) at (-5mm,\stockheight-1in-\trytopmargin@cx-\tryheadsep@cx-\tryheadheight@cx);
\draw [dim,|<->|] (H1) -- (H2);
\node[left,text width=1.5cm, text ragged left] at (-5mm,\stockheight-0.5*\margintop){top\\ \convert@cx{\the\margintop}};

% bottom dimension at left
\coordinate (H3) at (-5mm,0);
\coordinate (H4) at (-5mm,\marginbottom);
\draw [dim,|<->|] (H3) -- (H4);
\node[left] at (-5mm,0.5*\marginbottom){\convert@cx{\the\marginbottom}};

% textheight at left
\draw[dim,<->]  (-5mm, \marginbottom) -- ++ (0,\trytextheight@cx);
\node[left,text width=1.5cm,text ragged left] at (-5mm,\marginbottom+0.5\trytextheight@cx){textheight \convert@cx{\trytextheight@cx}};


% trimedge
\coordinate (D) at (\stockwidth-4\trimedge, 0.10\trytextheight@cx);
\coordinate (E) at (\stockwidth,0.10\trytextheight@cx);
\draw [dim,->|] (D) -- ++(3\trimedge,0);
\draw [dim,|<-|] (E) -- ++(3\trimedge,0) node at ++(0,0) [right,text width=2cm,color=black] {trim edge \convert@cx{\the\trimedge}};

% toptrim
%\ifdim\trimtop>0pt
  \coordinate (F) at (0.9\stockwidth, \stockheight-\trimtop-8mm);
  \coordinate (G) at (0.9\stockwidth, \stockheight-\trimtop);
  \coordinate (H) at (0.9\stockwidth,\stockheight);
  \draw (F)[dim,->|] -- (G);
  \draw (H) -- ++ (0,8mm) -- ++ (5mm,0)[|<-|,>=latex] 
          node [right] at ++ (0,0) {top trim =  \convert@cx{\the\trimtop}};
%\fi

% 1in offsets
\draw[dashed,color=gray] (1in,0) -- (1in,\stockheight);
\draw[dashed,color=gray] (0in,\stockheight-1in)-- ++ (\stockwidth,0);

% oddsidemargin/evensidemargin
% draw dimension and name based on even or odd page
\draw[dim,|<->|] (0,0.1\trytextheight@cx) -- ++(1in+\innermargin,0) node[right] at ++ (2ex,0) [text width=2cm,color=red] {\innermarginname\  \convert@cx{\the\innermargin}};

% HEADER
\coordinate (I) at (1in-\lefttrim+\innermargin,\stockheight-1in-\tryheadheight@cx-\topmargin+\trimtop);
\draw (I) rectangle ++ (\textwidth,\tryheadheight@cx);

%\draw[dim,<->] (1.5in\tol,\stockheight) -- ++(0,-1in) node[above right] at ++ (0,0.2in) {1in + yoffset};

% add in inch 
\draw [dim,|-|] (\stockwidth+3ex,\stockheight-\trimtop)
      -- ++(0,-1in) node [right] at ++(2ex,0.65in) {offset=\convert@cx{1in}};

%   add topmargin dimension
\ifdim\topmargin>0pt
\draw [dim,|-] (\stockwidth+3ex,\stockheight-1in+\trimtop)
      -- ++(0,-\trytopmargin@cx) node [right] at ++(2ex,0.5\trytopmargin@cx) {topmargin=\convert@cx{\topmargin}};
\fi

%  add headheight dimension
\draw [dim,|-|] (\stockwidth+3ex,\stockheight-1in+\trimtop-\topmargin)
        -- ++(0,-\tryheadheight@cx) node [right] at ++(2ex,0.5\tryheadheight@cx) {headheight=\convert@cx{\the\tryheadheight@cx}};

%   add headsep dimension
\draw [dim,|-] (\stockwidth+3ex,\stockheight-1in+\trimtop-\tryheadsep@cx-\tryheadheight@cx-\topmargin)
          -- ++(0,\tryheadsep@cx) node [below right] at ++(2ex,0){headsep = \convert@cx{\the\tryheadsep@cx}};

% footskip dimension
\draw [dim,|-|] (\stockwidth+3ex,\stockheight-1in+\trimtop-\tryheadsep@cx-\tryheadheight@cx-\topmargin-\trytextheight@cx) -- ++(0,-\tryfootskip@cx) node [right] at ++(2ex,0.5\tryfootskip@cx){footskip=\convert@cx{\the\tryfootskip@cx}};


% textarea
\coordinate (J) at (1in-\lefttrim+\innermargin,\stockheight-1in+\trimtop-\tryheadheight@cx-\trytopmargin@cx-\tryheadsep@cx-\trytextheight@cx);
\draw[fill=lightgray!50] (J) rectangle ++ (\textwidth,\trytextheight@cx);

\draw[dim,<->|] (1in-\lefttrim+\innermargin,0.75\trytextheight@cx) -- ++(\textwidth, 0)  node at ++(-0.5\textwidth,0.5\baselineskip) {textwidth} node at ++ (-0.5\textwidth,-\baselineskip) {\convert@cx{\the\textwidth}};

% draw grid
\draw[xstep=(\paperwidth-\trimedge)/9, ystep=(\stockheight-\trimtop)/9,color=gray,dotted]  (0,0) grid (\paperwidth,\paperheight); 
%%   add textheight dimension
%\draw [dim,-] (\stockwidth+3ex,\stockheight-1in+\trimtop-\headsep-\headheight-\topmargin) -- ++(0,-\textheight) node [right] at ++(2ex,0.5\textheight){textheight=\convert@cx{\the\textheight}};

% footer
\coordinate (I) at (1in-\lefttrim+\innermargin,  \stockheight-1in+\trimtop-\tryheadheight@cx-\trytopmargin@cx-\tryheadsep@cx-\trytextheight@cx-\tryfootskip@cx);
\draw (I) rectangle ++ (\textwidth,\tryheadheight@cx);


% marginpar
\def\leftmarginpar{%
    \draw [fill=Linen,opacity=0.7] (1in+\innermargin+\textwidth+\marginparsep,   \stockheight-1in+\trimtop-\trytopmargin@cx-\tryheadsep@cx-\tryheadheight@cx ) rectangle ++(\marginparwidth,-\trytextheight@cx);
 \draw [dim,|<->|] (1in-\lefttrim+\textwidth+\innermargin+\marginparsep+\marginparwidth,0.75\trytextheight@cx) -- ++ (-\marginparwidth,0) node at ++(0.5\marginparwidth,0.5\baselineskip) {marginpar} node at ++(0.5\marginparwidth,-\baselineskip){\convert@cx{\the\marginparwidth}};
}

\def\rightmarginpar{%
 \draw [color=red] (1in+\innermargin-\marginparsep,\stockheight-1in+\trimtop-\topmargin-\headsep-\headheight ) rectangle ++(-\marginparwidth,-\textheight);
     \draw [dim,|<->|] (1in-\lefttrim+\innermargin-\marginparsep-\marginparwidth,0.75\textheight) -- ++ (\marginparwidth,0) node at ++(-0.5\marginparwidth,0.5\baselineskip) {marginpar} node at ++(-0.5\marginparwidth,-\baselineskip){\convert@cx{\the\marginparwidth}};
}

\ifdrawmarginpars
  \checkoddpage
  \alignedge
    \if@twoside
         \ifoddpage
            \leftmarginpar
         \else
            \rightmarginpar
        \fi
   \else
  % one side paper
        \leftmarginpar
    \fi
\fi

% draw diagonal
\ifoddpage
     \draw [color=blue]  (\paperwidth,0) -- (0, \paperheight);
  \else
    \draw [color=blue] (0,0) -- (\paperwidth,\paperheight);
\fi  
\end{tikzpicture}
}

\drawlayout
 
\clearpage

\drawlayout


\clearpage
\def\spread{%
\begin{tikzpicture}[scale=0.25]
% draw the two pages
\setlength\bindingcorrection{60pt}
\draw[xstep=\paperwidth/9,ystep=\paperheight/9, line width=1.2pt] (0,0) rectangle (\paperwidth,\paperheight)  (\paperwidth+\bindingcorrection,0) rectangle ++(\paperwidth,\paperheight);

% draw the binding correction
\draw[fill=gray, draw] (\paperwidth,0)  rectangle ++(\bindingcorrection,\paperheight);

\draw[xstep=(\paperwidth)/9, ystep=(\stockheight)/9,color=gray,]  (0,0) grid (\paperwidth,\paperheight);

\draw[xstep=(\paperwidth)/9, ystep=(\stockheight)/9,color=gray]  (\paperwidth+\bindingcorrection,0) grid ++(\paperwidth,\paperheight);

% add type areas

\draw[fill=gray] (0+2\paperwidth/9,\paperheight/9) rectangle ++ (\trytextwidth,7pt+\paperheight-2\paperheight/9);

\draw[fill=gray] (\paperwidth+\paperwidth/9+\bindingcorrection,\paperheight/9) rectangle ++ (\trytextwidth,7pt+\paperheight-2\paperheight/9);

\ifdim\bindingcorrection>0pt
\draw[color=white,font={\sffamily\bfseries}] node at (\paperwidth+0.5\bindingcorrection, 0.5\paperheight)[rotate=90,inner sep=0pt,outer sep=0pt] {BINDING CORRECTION};\fi

\node [color=white,font={\sffamily\bfseries}] at (0.5\paperwidth,0.5\paperheight)  {LEFT PAGE};
\node [color=white,font={\sffamily\bfseries}] at (1.5\paperwidth+\bindingcorrection,0.5\paperheight){RIGHT PAGE};
\end{tikzpicture}
}

\spread
\bigskip

%\printgeometryvalues{}
\readability
% end of two page spread
\printgeometryvalues

\clearpage



\subsection{Headers and footers}
A page may have two additional items, and usually has at least one of these. They are the
running header and running footer. If the page has a folio then it is located either in the
header or in the footer. The word ‘in’ is used rather lightly here as the folio may not be
actually in the header or footer but is always located at some constant relative position. A
common position for the folio is towards the fore-edge of the page, either in the header or
the footer. This makes it easy to spot when thumbing through the book. It may be placed
at the center of the footer, but unless you want to really annoy the reader do not place it
near the spine.

Often a page header contains the current chapter title, with perhaps a section title on
the opposite header, as aids to the reader in navigating around the book. Some books put
the book title into one of the headers, usually the verso one, but I see little point in that as
presumably the reader knows which particular book he is reading, and the space would
be better used providing more useful signposts.

\subsubsection{Determining the geometry of the headers and footers}

The important parameter in the calculation of the header and footers, is the \cs{headheight} and \cs{headsep}. Most classes tend to have these as fixed parameters, related to font-size as can be seen in Table~\ref{tab:headerparams}.

\begin{table}[htbp]
\centering
\caption{Header and footer parameters settings by common classes.}
\label{tab:headerparams}
\begin{tabular}{llll}
\toprule
                    &headsep                   &headheight &footskip\\
\midrule
LaTeX 10pt    &             &                 &           \\
LaTeX 11pt    &             &                 &           \\
LaTeX 12pt    &             &                 &           \\
Octavo          &             &                 &           \\
tufte-book     &2 \texttt{baselineskip}   & 1 baselineskip           &            \\
\bottomrule
\end{tabular}
\end{table}

\begin{figure}[htbp]
\includegraphics[width=\textwidth]{paradoxicalbrain}
\caption{Modern book approach to footer and header design. From \textit{Paradoxical Brain,} Narinder Kapur \textit{et al.}, Cambridge Univerity Press, 2011. Book is printed on Royal size paper.}
\label{fig:paradoxical}
\end{figure}

\begin{figure}[htbp]
{{\parindent0pt
\begin{tikzpicture}[inner sep=0pt,outer sep=0pt]
  \node (img) {\includegraphics[height=8cm]{paradoxicalbrain}};
  \draw  (img.north east) ++ (5pt,0pt)-- ++ (15pt,0) ++(-15pt, -0.083*8cm) --++ (15pt,0pt) 
            (img.south east) ++ (5pt,0pt) -- ++ (15pt,0pt) ++ (0,0.075*8cm) -- ++ (-15pt,0);
\end{tikzpicture}}}
\caption{Modern book approach to footer and header design. From \textit{Paradoxical Brain,} Narinder Kapur \textit{et al.}, Cambridge Univerity Press, 2011. Book is printed on Royal size paper. The top margin is $1/12$ of the page height and the bottom margin is $1/16$ of page height. No need for apogryphal methods here.}
\label{fig:paradoxical}
\end{figure}

The more modern style tends to shift the headers and footers towards the top edge and bottom edge of the paper respectively, and allows very little space at the top of the paper. Figure~\ref{fig:paradoxical} shows a footer that is very near the bottom of the text and a header that has been shifted upwards. This makes for a more economical design as it increases the amount of text that can be printed in the typed area. For special designs such as this, it is not possible to automate calculations other than specifying a full algorithm for margins and typed area. Margins for the example follow the 10/12 rule for the typed area and inner and outer margins are equal at 1:12 ratio to the trimmed paper width.
\section{Floating parameters}


\section{Summing up}

Although one would ideally like to input some constraints and get out a perfect layout, as the previous discussion shows this is not an easy task, as well 

%%\end{document}
%\lipsum[1-4]\marginnote[1pt]{\lorem
%    \lorem}
%
%\lipsum[1-2]

%% Stick the caption in the head might as well place the first picture also
\def\asidecaption{\parbox{4.2cm}{{\bfseries Image \thefigure}\par\lorem}%
  % \addtocontents{lof}{This is image 8}
}
\def\ps@caption{%
     \let\@oddfoot\@empty\let\@evenfoot\@empty%
    \def\@evenhead{%
        \begin{picture}(0,0)%
           \put(-150,-80){\asidecaption\par}%
            \stepcounter{figure}
           \put(-150,-370){\asidecaption}%
        \end{picture}%
      }%
    \let\@oddhead\@evenhead%
    \let\@mkboth\@gobbletwo%
    \let\chaptermark\@gobble%
    \let\sectionmark\@gobble%
 }

\def\ps@bigpicture{%
    \setlength\headheight{19cm}%
    \let\@oddfoot\@empty\let\@evenfoot\@empty%
    \def\@evenhead{%
         \begin{picture}(0,0)%
          \put(-149,0){\includegraphics[width=\dimexpr(\textwidth+150pt)]{stuartpearson}}%
         \end{picture}%
      }%
    \let\@oddhead\@evenhead%
    \let\@mkboth\@gobbletwo%
    \let\chaptermark\@gobble%
    \let\sectionmark\@gobble%
 }



\def\doubletakeimage{%
  \renewcommand{\topfraction}{.95}  % ensure seecond image will not float away
  \begin{figure}[t]
    \thispagestyle{caption}
    \includegraphics[width=\textwidth]{matron}%
  \end{figure}

  \begin{figure}[tp]
   \hspace*{-\marginparwidth}\includegraphics[height=0.9\textheight]{stuartpearson}
 \end{figure}
}




\lipsum[1-4]
\begin{figure}[htp]
\includegraphics[width=0.98\textwidth]{captionspecial}
\centering
\caption{Figure from \textit{Oxford History of Art, Portraiture}, Shearer West, Oxford University Press, 2004. The figures are numbered consecutively and the text in the List of Illustrations have different formatting.}
\end{figure}

\doubletakeimage



%% RESET EVERYTHING AT END OF CHAPTER
\addtocounter{chapter}{-2}

\@toctrue\@specialtrue
